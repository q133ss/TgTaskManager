<?php

namespace App\Http\Controllers;

use App\Models\User;
use App\Services\TaskService;
use App\Services\TelegramService;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;

class TelegramBotController extends Controller
{
    protected TelegramService $telegramService;
    protected TaskService $taskService;

    public function __construct(TelegramService $telegramService, TaskService $taskService)
    {
        $this->telegramService = $telegramService;
        $this->taskService = $taskService;
    }

    private function getTaskKeyboard(string $chatId): array
    {
        return [
            'inline_keyboard' => [
                [
                    [
                        'text' => "inbox",
                        'web_app' => [
                            'url' => route('telegram.inbox', ['chat_id' => $chatId])
                        ]
                    ]
                ]
            ]
        ];
    }

    private function sendTasksMessage($taks, $chatId, $isGroup = false){
        if($taks->isEmpty()){
            $this->telegramService->sendMessage($chatId, 'Ð—Ð°Ð´Ð°Ñ‡Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚');
            return;
        }
        $taskText = '';
        foreach ($taks as $task) {
            $taskText .= 'â€¢ '.$task->text . PHP_EOL;
        }

        if(!$isGroup){
            $keyboard = $this->getTaskKeyboard($chatId);
            $this->telegramService->sendMessage($chatId, $taskText, json_encode($keyboard));
        }else{
            $this->telegramService->sendMessage($chatId, $taskText);
        }
    }

    /**
     * @param $chatId
     * @param $text
     * @param $user
     * @param $isGroup
     * @return bool
     *
     * ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹. Ð•ÑÐ»Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°, ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ false
     */
    private function proccesedCommand($chatId, $text, $user, $isGroup): bool
    {
        switch ($text) {
            case '/start':
                $this->sendWelcomeMessage($chatId);
                break;
            case '/all':
                $taks = $user->tasks;
                $this->sendTasksMessage($taks, $chatId, $isGroup);
                break;
            case '/today':
                $taks = $user->tasks?->where('date', now()->format('Y-m-d'));
                $this->sendTasksMessage($taks, $chatId, $isGroup);
                break;
            case '/tomorrow':
                $taks = $user->tasks?->where('date', now()->addDay()->format('Y-m-d'));
                $this->sendTasksMessage($taks, $chatId, $isGroup);
                break;
            case '/help':
                $this->telegramService?->sendMessage($chatId, 'Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ Â«OK, Bob!Â» Ð²Ñ‹ Ð²ÑÐµÐ³Ð´Ð° Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð½Ð°Ð¹Ñ‚Ð¸ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ okbob.app.

ÐÐ°Ñ‡Ð°Ð»Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð² OK, Bob!

Ð—Ð°Ð´Ð°Ñ‡Ð¸
â€¢ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡
â€¢ Ð¡Ð¿Ð¸ÑÐºÐ¸ Ð·Ð°Ð´Ð°Ñ‡
â€¢ Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ Ð·Ð°Ð´Ð°Ñ‡Ð¸
â€¢ ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ
â€¢ Ð¢ÐµÐ³Ð¸
â€¢ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

Ð Ð°Ð±Ð¾Ñ‚Ð° Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ…
â€¢ ÐÐ°Ñ‡Ð°Ð»Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
â€¢ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ…
â€¢ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸
â€¢ ÐžÑ‚Ñ‡ÐµÑ‚Ñ‹

Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾
â€¢ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
â€¢ ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±Ð¾Ñ‚Ð° Ð² Telegram
â€¢ Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ: iCalendar
â€¢ Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ: Ð²ÐµÐ±Ñ…ÑƒÐºÐ¸
â€¢ Ð“Ð¾Ñ€ÑÑ‡Ð¸Ðµ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ¸
â€¢ Ð˜ÐºÐ¾Ð½ÐºÐ° Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

ðŸ“¢ ÐŸÐ¾Ð´Ð¿Ð¸ÑÑ‹Ð²Ð°Ð¹Ñ‚ÐµÑÑŒ Ð½Ð° Ð½Ð°Ñˆ ÐºÐ°Ð½Ð°Ð» @okbob, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð² ÐºÑƒÑ€ÑÐµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹.

ðŸ‘¥ ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐ¹Ñ‚ÐµÑÑŒ Ðº Ð½Ð°ÑˆÐµÐ¼Ñƒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ñƒ Ð² Ñ‡Ð°Ñ‚Ðµ @okbob_chat â€“ Ñ‚Ð°Ð¼ Ð²Ñ‹ Ð²ÑÐµÐ³Ð´Ð° ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚ Ð½Ð° ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ.');
                break;
            default:
                // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ñƒ, ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ð½Ðµ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ðµ Ð¸ ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ð½Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ð°
                if(!isset($message['voice']) && !$isGroup) {
                    $create = $this->taskService?->create($chatId, $text, null);
                    $keyboard = $this->getTaskKeyboard($chatId);
                    $this->telegramService?->sendMessage($chatId, 'â˜‘ï¸' . $create->text, json_encode($keyboard));
                }
                return false;
        }

        return true;
    }

    public function handleUpdate($update): void
    {
        if (isset($update['message'])) {
            $message = $update['message'] ?? '';
            $chatId = $message['chat']['id'] ?? ''; // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ chat_id
            $text = $message['text'] ?? '';

            $userId = $message['from']['id'];
            $username = $message['from']['username'] ?? 'User';

            $chatType = $message['chat']['type'] ?? '';
            $isGroup = in_array($chatType, ['group', 'supergroup']); // Ð¤Ð»Ð°Ð³. Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¸Ð»Ð¸ Ð¸Ð· Ð»Ð¸Ñ‡Ð½Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐ¸

            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¸ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
            $user = $this->findOrCreateUser($chatId, $message);

            // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
            if (isset($message['voice'])) {
                $this->handleVoiceMessage($message, $chatId, $user);
            }

            // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹ Ð±Ð¾Ñ‚Ð°
            if (str_starts_with($text, env('BOT_USERNAME'))) {
                $this->processTaskGroupCommand($text, $chatId, $userId, $username);
            }

            $this->proccesedCommand($chatId, $text, $user, $isGroup);
        } elseif (isset($update['callback_query'])) {
            $callbackQuery = $update['callback_query'];
            $data = $callbackQuery['data'];
            $chatId = $callbackQuery['message']['chat']['id'];
            $messageId = $callbackQuery['message']['message_id'];

            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¸ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
            $user = $this->findOrCreateUser($chatId, $callbackQuery['message']['chat']);

            $this->handleCallbackQuery($chatId, $messageId, $data);
        }

        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð±Ñ‹Ð» Ð»Ð¸ Ð±Ð¾Ñ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² Ñ‡Ð°Ñ‚
        if (isset($message['new_chat_members'])) {
            $chatId = $update['message']['chat']['id'];
            foreach ($message['new_chat_members'] as $member) {
                if ($member['id'] == env('BOT_ID')) {
                    $this->telegramService?->sendMessage($chatId, "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ñ‡Ñ‚Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð»Ð¸ Ð¼ÐµÐ½Ñ Ð² ÑÑ‚Ð¾Ñ‚ Ñ‡Ð°Ñ‚! Ð¯ Ð¿Ð¾Ð¼Ð¾Ð³Ñƒ Ð²Ð°Ð¼ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸.");
                }
            }
        }
    }

    // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ñ‹Ñ… Ñ‡Ð°Ñ‚Ð¾Ð²
    private function processTaskGroupCommand($text, $chatId, $userId, $username)
    {
        // Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð±Ð¾Ñ‚Ð° Ð¸Ð· Ñ‚ÐµÐºÑÑ‚Ð°
        $taskText = str_replace(env('BOT_USERNAME'), '', $text);

        // Ð Ð°Ð·Ð´ÐµÐ»ÑÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¸ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
        preg_match('/@(\w+)$/', $taskText, $assigneeMatch); // Ð˜Ñ‰ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐµ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

        if (!empty($assigneeMatch)) {
            // Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒ ÑƒÐºÐ°Ð·Ð°Ð½
            $assigneeUsername = $assigneeMatch[1];
            $taskText = trim(str_replace($assigneeMatch[0], '', $taskText)); // Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ

            // ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ð¾ username
            $assignee = User::where('username', $assigneeUsername)->first();
            if (!$assignee) {
                $this->telegramService?->sendMessage($chatId, "ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ @$assigneeUsername Ð½Ðµ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ. ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² Ð±Ð¾Ñ‚Ð° Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /start.");
                return;
            }

            // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð´Ð»Ñ Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
            $this->taskService?->create($assignee->telegram_id, $taskText, null, $assignee->id);
            $this->telegramService?->sendMessage($chatId, "Ð—Ð°Ð´Ð°Ñ‡Ð° \"$taskText\" Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ @$assigneeUsername.");
        } else {
            $user = User::where('username', $username)->first();
            if (!$user) {
                $this->telegramService?->sendMessage($chatId, "ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ @$user Ð½Ðµ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ. ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² Ð±Ð¾Ñ‚Ð° Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /start.");
                return;
            }
            $formattedText = str_replace(env('BOT_USERNAME'), '', $text);
            $command = $this->proccesedCommand($user->telegram_id, trim($formattedText), $user, true);
            if(!$command){
                $this->taskService?->create($user->telegram_id, $taskText, null, null, $username);
                $this->telegramService?->sendMessage($chatId, "Ð—Ð°Ð´Ð°Ñ‡Ð° \"$taskText\" ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ð´Ð»Ñ Ð²Ð°Ñ, @$username.");
            }
        }
    }

    /**
     * ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ.
     */
    private function handleVoiceMessage($message, $chatId, $user)
    {
        $voiceFileId = $message['voice']['file_id'];
        $token = env('BOT_TOKEN');

        try {
            // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ñ„Ð°Ð¹Ð»Ðµ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
            $fileResponse = Http::get("https://api.telegram.org/bot{$token}/getFile", [
                'file_id' => $voiceFileId,
            ]);
            $fileInfo = json_decode($fileResponse->body(), true);
            $filePath = $fileInfo['result']['file_path'];

            // Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ñ„Ð°Ð¹Ð» Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
            $fileUrl = "https://api.telegram.org/file/bot{$token}/{$filePath}";
            $voiceFile = Http::get($fileUrl);

            // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ„Ð°Ð¹Ð» Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
            $tempFilePath = storage_path('app/temp/' . uniqid() . '.ogg');
            file_put_contents($tempFilePath, $voiceFile->body());

            // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ñ„Ð°Ð¹Ð» Ð² Yandex SpeechKit Ð´Ð»Ñ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð²Ð°Ð½Ð¸Ñ
            $recognizedText = $this->recognizeSpeechWithYandex($tempFilePath);

            // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
            unlink($tempFilePath);

            // Ð•ÑÐ»Ð¸ Ñ‚ÐµÐºÑÑ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð½, ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
            if (!empty($recognizedText)) {
                $create = $this->taskService?->create($chatId, $recognizedText, null);
                $keyboard = $this->getTaskKeyboard($chatId);
                $this->telegramService?->sendMessage($chatId, 'â˜‘ï¸' . $create->text, json_encode($keyboard));
            } else {
                $this->telegramService->sendMessage($chatId, "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ñ‚ÑŒ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ.");
            }
        } catch (\Exception $e) {
            Log::error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ: ' . $e->getMessage());
            $this->telegramService->sendMessage($chatId, "ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ.");
        }
    }

    /**
     * ÐšÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ OGG Ð² WAV.
     */
    private function convertOggToWav($oggFilePath): string
    {
        $wavFilePath = str_replace('.ogg', '.wav', $oggFilePath);
        exec("ffmpeg -i {$oggFilePath} -ar 16000 -ac 1 {$wavFilePath}");
        return $wavFilePath;
    }

    /**
     * Ð Ð°ÑÐ¿Ð¾Ð·Ð½Ð°ÐµÑ‚ Ñ€ÐµÑ‡ÑŒ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Yandex SpeechKit.
     */
    private function recognizeSpeechWithYandex($oggFilePath): string
    {
        $folderId = env('YANDEX_FOLDER_ID');
        $iamToken = env('YANDEX_IAM_TOKEN');

        if (!$folderId || !$iamToken) {
            Log::error('ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ folderId Ð¸Ð»Ð¸ iamToken Ð´Ð»Ñ Yandex SpeechKit.');
            return '';
        }

        // URL Ð´Ð»Ñ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð²Ð°Ð½Ð¸Ñ Ñ€ÐµÑ‡Ð¸
        $url = "https://stt.api.cloud.yandex.net/speech/v1/stt:recognize?folderId={$folderId}&lang=ru-RU";

        // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ñ„Ð°Ð¹Ð» Ñ‡ÐµÑ€ÐµÐ· cURL
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, file_get_contents($oggFilePath)); // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ñ„Ð°Ð¹Ð»Ð°
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'Authorization: Bearer ' . $iamToken,
            'Content-Type: audio/ogg', // Ð£ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‚Ð¸Ð¿ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
        ]);

        // Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ
        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);

        if ($httpCode !== 200) {
            Log::error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð²Ð°Ð½Ð¸Ð¸ Ñ€ÐµÑ‡Ð¸ (HTTP {$httpCode}): " . $response);
            return '';
        }

        // ÐŸÐ°Ñ€ÑÐ¸Ð¼ Ð¾Ñ‚Ð²ÐµÑ‚
        $result = json_decode($response, true);
        return $result['result'] ?? ''; // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚
    }

    /**
     * ÐÐ°Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ð¾ telegram_id Ð¸Ð»Ð¸ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð½Ð¾Ð²Ð¾Ð³Ð¾.
     *
     * @param int $chatId
     * @param array $chatData
     * @return \App\Models\User
     */
    private function findOrCreateUser(int $chatId, array $chatData): \App\Models\User
    {
        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ñ Ñ‚Ð°ÐºÐ¸Ð¼ telegram_id
        $user = \App\Models\User::where(['telegram_id' => $chatId])
        ->orWhere('username', $chatData['from']['username'] ?? null)->first();

        // Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹, Ð·Ð°Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
        if (!$user) {
            $user = new \App\Models\User();
            $user->telegram_id = $chatId;
            $user->first_name = $chatData['from']['first_name'] ?? null;
            $user->last_name = $chatData['from']['last_name'] ?? null;
            $user->username = $chatData['from']['username'] ?? null;
            $user->save();

            $this->getAndSaveUserProfilePhotoLink($chatId, $user);
        }

        return $user;
    }

    private function getAndSaveUserProfilePhotoLink(int $chatId, \App\Models\User $user): void
    {
        try {
            $token = env('BOT_TOKEN');
            // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ file_id Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð°
            $response = Http::get("https://api.telegram.org/bot{$token}/getUserProfilePhotos", [
                'user_id' => $chatId,
                'limit' => 1,
            ]);
            $userProfilePhotos = json_decode($response->body(), true);

            if (!isset($userProfilePhotos['result']['photos'][0][0])) {
                return; // ÐÐ²Ð°Ñ‚Ð°Ñ€ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚
            }

            $photoFileId = $userProfilePhotos['result']['photos'][0][0]['file_id'];

            // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ñ„Ð°Ð¹Ð»Ðµ
            $fileResponse = Http::get("https://api.telegram.org/bot{$token}/getFile", [
                'file_id' => $photoFileId,
            ]);
            $fileInfo = json_decode($fileResponse->body(), true);
            $filePath = $fileInfo['result']['file_path'];

            // Ð¡Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ñ€ÑÐ¼ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ð°Ð²Ð°Ñ‚Ð°Ñ€
            $avatarUrl = "https://api.telegram.org/file/bot{$token}/{$filePath}";

            // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÑÑÑ‹Ð»ÐºÑƒ Ð² Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
            $user->avatar_url = $avatarUrl;
        } catch (\Exception $e) {
            // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐµÑÐ»Ð¸ Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð° Ð½ÐµÑ‚)
        }
    }

    protected function sendWelcomeMessage($chatId)
    {
        $keyboard = [
            'inline_keyboard' => [
                [
                    ['text' => 'Ð”Ð°Ð»ÐµÐµ', 'callback_data' => 'next_2']
                ]
            ]
        ];

        $text = "ðŸ¤– ÐŸÑ€Ð¸Ð²ÐµÑ‚, ÑÑ‚Ð¾ Â«OK, Bob!Â» â€” Ð²Ð°Ñˆ Ð±Ð¾Ñ‚-Ð°ÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚ Ð¸ Ñ‚Ñ€ÐµÐºÐµÑ€ Ð·Ð°Ð´Ð°Ñ‡ Ð´Ð»Ñ Telegram!

Â«OK, Bob!Â» Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð² ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ñ… Ð¿Ñ€ÑÐ¼Ð¾ Ð¸Ð· Ñ‡Ð°Ñ‚Ð¾Ð², Ð° Ñ‚Ð°ÐºÐ¶Ðµ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ Ð´ÐµÐ»Ð°Ð¼Ð¸ Ð¸ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€Ñ‘Ð¼. â°

Ð’ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… 10 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÑ… Ð¼Ñ‹ ÐºÑ€Ð°Ñ‚ÐºÐ¾ Ñ€Ð°ÑÑÐºÐ°Ð¶ÐµÐ¼ Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÑ….

ðŸ“š ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð²ÑÐµÐ³Ð´Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ Ð¸Ð»Ð¸ Ð¸Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /help Ð² Ð±Ð¾Ñ‚Ðµ.

Ð•ÑÐ»Ð¸ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½ÑƒÑ‚ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ â€” Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð² Ñ‡Ð°Ñ‚ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸, Ð¸ Ð¼Ñ‹ Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÐ¼! ðŸ’¬

ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð”Ð°Ð»ÐµÐµ âž¡ï¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ, ÐºÐ°Ðº ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð² Ð±Ð¾Ñ‚Ðµ.";
        $this->telegramService->sendMessage($chatId, $text, json_encode($keyboard));
    }

    protected function handleCallbackQuery($chatId, $messageId, $data)
    {
        $stepMessages = [
            'next_1' => [
                'text' => 'ðŸ¤– ÐŸÑ€Ð¸Ð²ÐµÑ‚, ÑÑ‚Ð¾ Â«OK, Bob!Â» â€” Ð²Ð°Ñˆ Ð±Ð¾Ñ‚-Ð°ÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚ Ð¸ Ñ‚Ñ€ÐµÐºÐµÑ€ Ð·Ð°Ð´Ð°Ñ‡ Ð´Ð»Ñ Telegram!

Â«OK, Bob!Â» Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð² ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ñ… Ð¿Ñ€ÑÐ¼Ð¾ Ð¸Ð· Ñ‡Ð°Ñ‚Ð¾Ð², Ð° Ñ‚Ð°ÐºÐ¶Ðµ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ Ð´ÐµÐ»Ð°Ð¼Ð¸ Ð¸ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€Ñ‘Ð¼. â°

Ð’ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… 10 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÑ… Ð¼Ñ‹ ÐºÑ€Ð°Ñ‚ÐºÐ¾ Ñ€Ð°ÑÑÐºÐ°Ð¶ÐµÐ¼ Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÑ….

ðŸ“š ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð²ÑÐµÐ³Ð´Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ Ð¸Ð»Ð¸ Ð¸Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /help Ð² Ð±Ð¾Ñ‚Ðµ.

Ð•ÑÐ»Ð¸ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½ÑƒÑ‚ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ â€” Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð² Ñ‡Ð°Ñ‚ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸, Ð¸ Ð¼Ñ‹ Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÐ¼! ðŸ’¬

ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð”Ð°Ð»ÐµÐµ âž¡ï¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ, ÐºÐ°Ðº ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð² Ð±Ð¾Ñ‚Ðµ.',
                'next' => 'next_2'
            ],
            'next_2' => [
                'text' => "ÐšÐ°Ðº Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð² Ð±Ð¾Ñ‚Ðµ ðŸ“

Ð§Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð»ÑŽÐ±Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð»Ð¸Ñ‡Ð½Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐµ Ñ Ð±Ð¾Ñ‚Ð¾Ð¼.

Ð—Ð°Ð´Ð°Ñ‡Ð° Ð±ÐµÐ· ÑƒÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð´Ð°Ñ‚Ñ‹ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð² ÑÐ¿Ð¸ÑÐ¾Ðº Â«Ð˜Ð½Ð±Ð¾ÐºÑÂ» â€“ ÑÑ‚Ð¾Ñ‚ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ, ÐµÑÐ»Ð¸:
- Ð½Ð°Ð¶Ð°Ñ‚ÑŒ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð¿Ð¾Ð´ Ð¾Ñ‚Ð²ÐµÑ‚Ð½Ñ‹Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼ Ð² Ð±Ð¾Ñ‚Ðµ;
- Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /inbox Ð² Ð±Ð¾Ñ‚Ðµ.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡

ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð”Ð°Ð»ÐµÐµ âž¡ï¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ, ÐºÐ°Ðº ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð½Ð° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¸ Ð´ÐµÐ½ÑŒ.",
                'next' => 'next_3',
                'back' => 'next_1'
            ],
            'next_3' => [
                'text' => "ÐšÐ°Ðº ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ Ð¸ Ð²Ñ€ÐµÐ¼Ñ â±ï¸

ÐŸÑ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð´ÐµÐ½ÑŒ Ð¸ Ð²Ñ€ÐµÐ¼Ñ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð±Ð¾Ñ‚ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð» ÐµÑ‘ Ð² ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑŒ. Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ:
â€¢ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð´Ð°Ñ‚Ñƒ Ñ‡ÐµÑ€ÐµÐ· Ñ‚Ð¾Ñ‡ÐºÑƒ (21.04) Ð¸Ð»Ð¸ ÐºÐ¾ÑÑƒÑŽ Ñ‡ÐµÑ€Ñ‚Ñƒ (21/04);
â€¢ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ»Ð¾Ð²Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ, Ð·Ð°Ð²Ñ‚Ñ€Ð°, today, tomorrow Ð¸Ð»Ð¸ Ð´Ð½Ð¸ Ð½ÐµÐ´ÐµÐ»Ð¸ (Ð¿Ð¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðº, ÑÑƒÐ±Ð±Ð¾Ñ‚Ð°, Wednesday) Ð´Ð»Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐ³Ð¾ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð´Ð½Ñ;
â€¢ Ð·Ð°Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ñ‡ÐµÑ€ÐµÐ· Ð´ÐµÑ„Ð¸Ñ (14-00) Ð¸Ð»Ð¸ Ð´Ð²Ð¾ÐµÑ‚Ð¾Ñ‡Ð¸Ðµ (14:00).

ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:
Ð²ÑÑ‚Ñ€ÐµÑ‡Ð° Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼ Ð·Ð°Ð²Ñ‚Ñ€Ð° 14:00

Ð¡Ð¾Ð·Ð´Ð°ÑÑ‚ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°ÑˆÐ½Ð¸Ð¹ Ð´ÐµÐ½ÑŒ Ð½Ð° 14 Ñ‡Ð°ÑÐ¾Ð².

ðŸ“† Ð•ÑÐ»Ð¸ Ð²Ñ‹ ÑƒÐºÐ°Ð·Ð°Ð»Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð²Ñ€ÐµÐ¼Ñ, Ð±ÐµÐ· Ð´Ð°Ñ‚Ñ‹, Ð·Ð°Ð´Ð°Ñ‡Ð° Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑÑ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½Ð¸Ð¹ Ð´ÐµÐ½ÑŒ.
Ð’ Ð¿Ð»Ð°Ñ‚Ð½Ñ‹Ñ… Ñ‚Ð°Ñ€Ð¸Ñ„Ð°Ñ… Ð±Ð¾Ñ‚ Ñ‚Ð°ÐºÐ¶Ðµ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ñ‘Ñ‚ ÑÑ‚Ð¸ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹ Ð¸Ð· Ð°ÑƒÐ´Ð¸Ð¾ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² Ð»Ð¸Ñ‡Ð½Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐµ.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð¹ Ð¿Ð¾ÑÑ Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸.",
                'next' => 'next_4',
                'back' => 'next_2'
            ],
            'next_4' => [
                'text' => "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾ÑÑÐ° Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ âš™ï¸

Ð§Ñ‚Ð¾Ð±Ñ‹ Ð²Ñ€ÐµÐ¼Ñ Ñƒ Ð·Ð°Ð´Ð°Ñ‡ Ð¸ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¸ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾, Ð²Ð°Ð¶Ð½Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð¹ Ð¿Ð¾ÑÑ. ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ GMT+3 (ÐœÐ¾ÑÐºÐ²Ð°).

âœˆï¸ Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð¼ÐµÐ½ÑÑ‚ÑŒ Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð¹ Ð¿Ð¾ÑÑ, Ð¾Ñ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¼ÐµÐ½ÑŽ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Ð² Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð¸Ð»Ð¸ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° Ð¸ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð³Ð¾Ñ€Ð¾Ð´ Ð¸Ð»Ð¸ ÑÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.

Ð’ ÑÑ‚Ð¾Ð¼ Ð¶Ðµ Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾Ð¼ÐµÐ½ÑÑ‚ÑŒ ÑÐ·Ñ‹Ðº Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°, Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð»Ð¸ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡, Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ñ‚Ñ‘Ð¼Ð½ÑƒÑŽ Ñ‚ÐµÐ¼Ñƒ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Â«OK, Bob!Â» Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð» Ñ‚Ð°Ðº, ÐºÐ°Ðº ÑƒÐ´Ð¾Ð±Ð½Ð¾ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð²Ð°Ð¼.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ Ð¸ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ.",
                'next' => 'next_5',
                'back' => 'next_3'
            ],
            'next_5' => [
                'text' => "ÐšÐ°Ðº ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¸ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ â³

ÐŸÑ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð±Ð¾Ñ‚ Ð·Ð°Ñ€Ð°Ð½ÐµÐµ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ´Ð¸Ð» Ð²Ð°Ñ. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð´Ð°Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð·Ð° 15 Ð¼Ð¸Ð½ÑƒÑ‚, 1 Ñ‡Ð°Ñ Ð¸Ð»Ð¸ Ð´Ð°Ð¶Ðµ Ð·Ð° ÑÑƒÑ‚ÐºÐ¸ Ð´Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ð°.

ðŸ”” Ð”Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð² Ñ‚ÐµÐºÑÑ‚Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ, Ð·Ð° ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ÑÐ»Ð°Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ, Ð¿Ð¾ÑÐ»Ðµ Ð²Ð¾ÑÐºÐ»Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ Ð·Ð½Ð°ÐºÐ°: ![N]Ð¼, Ð³Ð´Ðµ N â€“ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¼Ð¸Ð½ÑƒÑ‚, Ð·Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð²Ð°Ñ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ´Ð¸Ñ‚ÑŒ.

Ð¢Ð°ÐºÐ¶Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð² Ñ‡Ð°ÑÐ°Ñ…, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:
Ð’ÑÑ‚Ñ€ÐµÑ‡Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð° 12-00 !1Ñ‡
ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð´Ñ‘Ñ‚ Ð·Ð°Ð²Ñ‚Ñ€Ð° Ð² 11.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ

âŒ›ï¸ Ð•ÑÐ»Ð¸ Ñƒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ ÐµÑÑ‚ÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ€Ð°Ð¼ÐºÐ¸ (Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°, Ð·Ð²Ð¾Ð½Ð¾Ðº), ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð² Ñ‡Ð°ÑÐ°Ñ… (1Ñ‡) Ð¸Ð»Ð¸ Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ… (15Ð¼)â€” Ñ‚Ð°Ðº Ð²Ð¾ Ð²ÐºÐ»Ð°Ð´ÐºÐµ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÂ» Ð² Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ. Ð­Ñ‚Ð¾ ÑƒÐ´Ð¾Ð±Ð½Ð¾ Ð´Ð»Ñ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð½Ñ Ð¸ Ð¸Ð·Ð±ÐµÐ¶Ð°Ð½Ð¸Ñ Ð½Ð°ÐºÐ»Ð°Ð´Ð¾Ðº.

Ð”Ð°Ð»ÐµÐµ âž¡ï¸  â€“ ÐºÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð° Ð² Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ….",
                'next' => 'next_6',
                'back' => 'next_4'
            ],
            'next_6' => [
                'text' => "ÐšÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ð¾Ñ‚ Ð² Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ… ðŸ‘¥

Ð§Ñ‚Ð¾Ð±Ñ‹ Ð²ÐµÑÑ‚Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð²ÑÐµÐ¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹, Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð° @okbob_bot Ð² Ð¾Ð±Ñ‰Ð¸Ð¹ Ñ‡Ð°Ñ‚. Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ñ‚ÑŒ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ @username Ð¸ ÑÑ€Ð°Ð·Ñƒ Ð½Ð°Ð·Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ.

âœ”ï¸ ÐšÐ°Ð¶Ð´Ñ‹Ð¹ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð²Ð¸Ð´ÐµÑ‚ÑŒ ÑÐ²Ð¾Ð¹ Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð·Ð°Ð´Ð°Ñ‡ Ð¸ ÑƒÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ, Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Â«Ð§Ð°Ñ‚Ñ‹Â» Ð² Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð¸ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° Ð²Ñ‹Ð²Ð¾Ð´ÑÑ‚ÑÑ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð²ÑÐµÑ… Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: Ð Ð°Ð±Ð¾Ñ‚Ð° Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ…

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑÐ¼Ð¸ Ð¯Ð½Ð´ÐµÐºÑ, Google Ð¸ Apple.",
                'next' => 'next_7',
                'back' => 'next_5'
            ],
            'next_7' => [
                'text' => "Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑÐ¼Ð¸: iCalendar Ð¸ webhooks ðŸ”—

Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð½Ð¸Ð¼Ð¸ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑÐ¼Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð½Ð° Ñ‚Ð°Ñ€Ð¸Ñ„Ðµ Â«Ð‘Ð¸Ð·Ð½ÐµÑÂ» Ð¸Ð· Ñ€Ð°Ð·Ð´ÐµÐ»Ð° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Ð² Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð¸ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°.

ðŸ“… Â«OK, Bob!Â» Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ iCalendar, Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ Ð²Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ð²Ñ‹Ð³Ñ€ÑƒÐ¶Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð² Ð¯Ð½Ð´ÐµÐºÑ.ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑŒ, Google Calendar, Apple Calendar Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€Ð¸.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· iCalendar

ðŸ”„ Ð¢Ð°ÐºÐ¶Ðµ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸ÑŽ Ð²ÐµÐ±Ñ…ÑƒÐºÐ¾Ð² (webhooks) â€” Ð±Ð¾Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð½Ð¾Ð²Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡Ð°Ñ… Ð² Ð½ÑƒÐ¶Ð½Ñ‹Ð¹ Ð²Ð°Ð¼ ÑÐµÑ€Ð²ÐµÑ.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±Ñ…ÑƒÐºÐ¸

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°.",
                'next' => 'next_8',
                'back' => 'next_6'
            ],
            'next_8' => [
                'text' => 'Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° Ð½Ð° ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ðµ ðŸ’»

Ð—Ð°Ð¹Ð´Ð¸Ñ‚Ðµ Ð½Ð° hey.okbob.app, Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·ÑƒÐ¹Ñ‚ÐµÑÑŒ Ñ‡ÐµÑ€ÐµÐ· Telegram, Ð¸ Ð²Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ ÑƒÐ´Ð¾Ð±Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸, ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€Ñ‘Ð¼ Ð¸ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¾Ð¹ Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð³Ð¾ ÑÐºÑ€Ð°Ð½Ð°.

ðŸ–¥ï¸ Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾ÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐºÐ¸ Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð³Ñ€ÑƒÐ¿Ð¿, Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸, ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸ÑÐ¼Ð¸. Ð˜Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð¿Ð¾Ð´ Ñ€Ð°Ð·Ð½Ñ‹Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°, Ñ‚Ð°Ðº Ñ‡Ñ‚Ð¾ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¾Ð²Ñ‹Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ»Ð° ÑÑ‚Ð°Ð½ÐµÑ‚ ÐµÑ‰Ñ‘ Ð¿Ñ€Ð¾Ñ‰Ðµ.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: Ð’ÐµÑ€ÑÐ¸Ñ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ ÐºÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸.',
                'next' => 'next_9',
                'back' => 'next_7',
            ],
            'next_9' => [
                'text' => 'Ð¢ÐµÐ³Ð¸ Ñƒ Ð·Ð°Ð´Ð°Ñ‡ ðŸ·ï¸

Ð”Ð»Ñ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ð¹ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ¸ Ð¸ Ð¿Ð¾Ð¸ÑÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ñ‚ÐµÐ³Ð¸ Ð¿Ñ€ÑÐ¼Ð¾ Ð² Ñ‚ÐµÐºÑÑ‚Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ñ Ð·Ð°Ð´Ð°Ñ‡Ð¸.

ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, #Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°, #ÑÑ€Ð¾Ñ‡Ð½Ð¾, #â—ï¸ â€” Ð»ÑŽÐ±Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð° Ð¸ Ð´Ð°Ð¶Ðµ emoji, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ð¾Ð¼Ð¾Ð³ÑƒÑ‚ Ð³Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸.

ðŸ”Ž ÐŸÐ¾Ñ‚Ð¾Ð¼ Ð»ÐµÐ³ÐºÐ¾ Ð½Ð°Ð¹Ñ‚Ð¸ Ð²ÑÑ‘ Ð¿Ð¾ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ Ñ‚ÐµÐ³Ñƒ Ð² ÑÐ¿Ð¸ÑÐºÐ°Ñ… Ð·Ð°Ð´Ð°Ñ‡ Ð² Ð±Ð¾Ñ‚Ðµ Ð¸Ð»Ð¸ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð¸ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: Ð¢ÐµÐ³Ð¸

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð³Ñ€ÑƒÐ¿Ð¿.',
                'next' => 'next_10',
                'back' => 'next_8',
            ],
            'next_10' => [
                'text' => 'ÐžÑ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð³Ñ€ÑƒÐ¿Ð¿ ðŸ“Š

Ð¡ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð³Ñ€ÑƒÐ¿Ð¿ Ð²Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¸ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹: ÐºÐ°ÐºÐ¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ Ð¸ ÐºÑ‚Ð¾ Ð¸Ð· ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐ´ÐµÐ»Ð°Ð».

ÐžÑ‚Ñ‡ÐµÑ‚Ñ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ð²ÐµÑ€ÑÐ¸Ð¸ Ð´Ð»Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° Ñ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ð° Ð½Ð° hey.okbob.app.

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: ÐžÑ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð² Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ…

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Telegram-Ð±Ð¾Ñ‚Ð°.',
                'next' => 'next_11',
                'back' => 'next_9',
            ],
            'next_11' => [
                'text' => 'ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±Ð¾Ñ‚Ð° Ð² Telegram ðŸ’¬
Ð’ Ñ‡Ð°Ñ‚Ðµ Ñ Ð±Ð¾Ñ‚Ð¾Ð¼ @okbob_bot Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹, Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ñ‡ÐµÑ€ÐµÐ· /:
â€¢ /all â€” Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð½ÐµÐ²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸,
â€¢ /today â€” Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ,
â€¢ /tomorrow â€” Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°,
â€¢ /inbox â€” Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð±ÐµÐ· ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ð¹ Ð´Ð°Ñ‚Ñ‹ (Ð¸Ð· Â«Ð˜Ð½Ð±Ð¾ÐºÑÐ°Â»),
â€¢/help â€” Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ.

Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ñ‚ÐµÐ³Ð°Ð¼:
â€¢ /all #bob â€” Ð²Ñ‹Ð²ÐµÐ´ÐµÑ‚ Ð²ÑÐµ Ð½ÐµÐ²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ñ Ñ‚ÐµÐ³Ð¾Ð¼ #bob,
â€¢ /today #bob #work â€” Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð¸Ð½ Ð¸Ð· ÑÑ‚Ð¸Ñ… Ñ‚ÐµÐ³Ð¾Ð².

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±Ð¾Ñ‚Ð°

Ð”Ð°Ð»ÐµÐµ âž¡ï¸ â€“ ÐºÐ°Ð½Ð°Ð» Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¸ Ñ‡Ð°Ñ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð°.',
                'next' => 'next_12',
                'back' => 'next_10',
            ],
            'next_12' => [
                'text' => 'Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾ÑˆÐ»Ð¸ Ð¾Ð½Ð±Ð¾Ñ€Ð´Ð¸Ð½Ð³ Ñ Â«OK, Bob!Â» ðŸ¤–

ðŸ“š ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð»Ð½Ð¾Ðµ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð²Ñ‹ Ð²ÑÐµÐ³Ð´Ð° ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ð½Ð°Ð¹Ñ‚Ð¸ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ: Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸

ðŸ“¢ ÐŸÐ¾Ð´Ð¿Ð¸ÑÑ‹Ð²Ð°Ð¹Ñ‚ÐµÑÑŒ Ð½Ð° ÐºÐ°Ð½Ð°Ð» @okbob, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€Ð²Ñ‹Ð¼Ð¸ ÑƒÐ·Ð½Ð°Ð²Ð°Ñ‚ÑŒ Ð¾Ð± Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÑÑ… Ð¸ Ð½Ð¾Ð²Ñ‹Ñ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑÑ….

ðŸ’¬ ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐ¹Ñ‚ÐµÑÑŒ Ðº Ð½Ð°ÑˆÐµÐ¼Ñƒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ñƒ Ð² Ñ‡Ð°Ñ‚Ðµ @okbob_chat, Ð³Ð´Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹, Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ð¾Ð¿Ñ‹Ñ‚Ð¾Ð¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ.

Ð£ÑÐ¿ÐµÑˆÐ½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð´Ð½ÐµÐ¹!',
                'back' => 'next_11',
                'next' => null
            ]
        ];

        if (isset($stepMessages[$data])) {
            $step = $stepMessages[$data];
            $keyboard = [
                'inline_keyboard' => [
                    array_filter([
                        $step['back'] ? ['text' => 'ÐÐ°Ð·Ð°Ð´', 'callback_data' => $step['back']] : null,
                        $step['next'] ? ['text' => 'Ð”Ð°Ð»ÐµÐµ', 'callback_data' => $step['next']] : null
                    ])
                ]
            ];

            $this->telegramService->editMessageText($chatId, $messageId, $step['text'], json_encode($keyboard));
        }
    }
}
